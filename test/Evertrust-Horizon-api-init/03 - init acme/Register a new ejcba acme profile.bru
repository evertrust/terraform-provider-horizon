meta {
  name: Register a new ejcba acme profile
  type: http
  seq: 6
}

post {
  url: {{horizonUrl}}/api/v1/certificate/profiles
  body: json
  auth: none
}

headers {
  X-API-ID: {{X-API-ID}}
  X-API-KEY: {{X-API-KEY}}
}

body:json {
  {
      "module": "acme",
      "name": "evertrust-ejbca-acme",
      "authorizationMethods": [
          "tls-alpn-01",
          "http-01",
          "dns-01"
      ],
      "verifyRetryCount": 3,
      "verifyRetryDelay": "3 s",
      "authorizeShortName": true,
      "authorizeEmptyContact": true,
      "requireTermsOfService": false,
      "pkiConnector": "evertrust-ejbca-serverauth",
      "authorizationLevels": {
          "revoke": {
              "accessLevel": "authorized"
          },
          "requestRevoke": {
              "accessLevel": "authorized"
          },
          "approveRevoke": {
              "accessLevel": "authorized"
          },
          "search": {
              "accessLevel": "authorized"
          },
          "requestUpdate": {
              "accessLevel": "authorized"
          },
          "approveUpdate": {
              "accessLevel": "authorized"
          },
          "update": {
              "accessLevel": "authorized"
          }
      },
      "constraints": {
          "allowedDnsDomains": ".*evertrust\\.fr"
      },
      "labels": [],
      "csrDataMapping": {},
      "triggers": {},
      "tlsAlpn01Port": 4443,
      "timeout": "10s",
      "requestsPolicy": {
          "revoke": "30m"
      },
      "cryptoPolicy": {
          "decentralized": true
      },
      "enabled": true,
      "selfPermissions": {}
  }
}

assert {
  res.body: isJson
  res.status: eq 201
  res.body.name: isDefined
  res.body._id: isDefined
}