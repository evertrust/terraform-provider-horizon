meta {
  name: Extract certificate and private key from the ra-p12 file
  type: http
  seq: 2
}

post {
  url: {{horizonUrl}}/api/v1/rfc5280/pkcs12
  body: multipartForm
  auth: none
}

headers {
  X-API-ID: {{X-API-ID}}
  X-API-KEY: {{X-API-KEY}}
}

body:multipart-form {
  password: evertrust123
  pkcs12: @file(keystore/ra.p12)
}

assert {
  res.body: isJson
  res.status: eq 200
  res.body.certificate.pem: isDefined
  res.body.privateKey: isDefined
}

script:post-response {
  bru.setEnvVar("raCertificate", res.getBody().certificate.pem.replace(/[\r\n]+/gm, "\\n"))
  bru.setEnvVar("raPrivateKey", res.getBody().privateKey.replace(/[\r\n]+/gm, "\\n"))
}
