meta {
  name: register a webra f5 as3 profile
  type: http
  seq: 3
}

post {
  url: {{horizonUrl}}/api/v1/certificate/profiles
  body: json
  auth: none
}

headers {
  X-API-ID: {{X-API-ID}}
  X-API-KEY: {{X-API-KEY}}
  X-API-IDPROV: {{LOCAL-PROVIDER-NAME}}
}

body:json {
  {
    "module": "webra",
    "authorizationMode": "authorized",
    "name": "webra-f5-as3",
    "enabled": true,
    "pkiConnector": "evertrust-integrated-serverauth",
    "authorizationLevels": {
      "enroll": {
        "accessLevel": "authorized"
      },
      "requestEnroll": {
        "accessLevel": "authorized"
      },
      "approveEnroll": {
        "accessLevel": "authorized"
      },
      "enrollApi": {
        "accessLevel": "authorized"
      },
      "revoke": {
        "accessLevel": "authorized"
      },
      "requestRevoke": {
        "accessLevel": "authorized"
      },
      "approveRevoke": {
        "accessLevel": "authorized"
      },
      "search": {
        "accessLevel": "authorized"
      },
      "migrate": {
        "accessLevel": "authorized"
      },
      "requestMigrate": {
        "accessLevel": "authorized"
      },
      "approveMigrate": {
        "accessLevel": "authorized"
      },
      "update": {
        "accessLevel": "authorized"
      },
      "requestUpdate": {
        "accessLevel": "authorized"
      },
      "approveUpdate": {
        "accessLevel": "authorized"
      },
      "recover": {
        "accessLevel": "authorized"
      },
      "requestRecover": {
        "accessLevel": "authorized"
      },
      "approveRecover": {
        "accessLevel": "authorized"
      },
      "recoverApi": {
        "accessLevel": "authorized"
      }
    },
    "cryptoPolicy": {
      "defaultKeyType": "rsa-2048",
      "authorizedKeyTypes": [
        "rsa-2048",
        "rsa-4096"
      ],
      "centralized": true,
      "decentralized": false,
      "escrow": false,
      "p12passwordPolicy": null,
      "p12storeEncryptionType": "DES_AVERAGE",
      "p12passwordMode": "random",
      "showP12PasswordOnEnroll": true,
      "showP12OnEnroll": true,
      "showP12PasswordOnRecover": false,
      "showP12OnRecover": false
    },
    "selfPermissions": {
      "selfRevoke": false,
      "selfUpdate": false,
      "selfRecover": false,
      "selfRenew": false,
      "selfPopRenew": false
    },
    "requestsPolicy": {
      "enroll": "7 days",
      "renew": "7 days",
      "revoke": "7 days",
      "update": "7 days",
      "migrate": "7 days"
    },
    "renewalPeriod": "3000d",
    "displayName": [],
    "description": [],
    "certificateTemplate": {
      "ownerPolicy": {
        "mandatory": false,
        "editableByRequester": false,
        "editableByApprover": false
      },
      "teamPolicy": {
        "mandatory": false,
        "editableByRequester": false,
        "editableByApprover": false
      },
      "contactEmailPolicy": {
        "mandatory": false,
        "editableByRequester": true,
        "editableByApprover": false
      },
      "subject": [
        {
          "type": "CN",
          "mandatory": true,
          "editableByRequester": true,
          "editableByApprover": false,
          "index": 2,
          "value": null,
          "regex": null,
          "testing": null,
          "computationRule": null
        }
      ],
      "sans": [
        {
          "type": "DNSNAME",
          "editableByRequester": true,
          "editableByApprover": false,
          "max": 2,
          "min": null,
          "regex": null,
          "testing": null,
          "computationRule": null,
          "index": 2
        }
      ]
    },
    "csrDataMapping": {},
    "triggers": {
      "onEnroll": [],
      "onRenew": [
        "{{F5as3Trigger}}"
      ],
      "onRevoke": [],
      "onExpire": [],
      "onPendingEnroll": null,
      "onPendingRevoke": null,
      "onPendingRecover": null,
      "onPendingUpdate": null,
      "onPendingMigrate": null
    }
  }
}

assert {
  res.body: isJson
  res.status: eq 201
  res.body.name: isDefined
  res.body._id: isDefined
}
