meta {
  name: register a webra profile
  type: http
  seq: 1
}

post {
  url: {{horizonUrl}}/api/v1/certificate/profiles
  body: json
  auth: none
}

headers {
  X-API-ID: {{X-API-ID}}
  X-API-KEY: {{X-API-KEY}}
  X-API-IDPROV: {{LOCAL-PROVIDER-NAME}}
}

body:json {
  {
      "module": "webra",
      "authorizationMode": "authorized",
      "name": "webra-profile",
      "enabled": true,
      "pkiConnector": "evertrust-integrated-serverauth",
      "authorizationLevels": {
          "enroll": {
              "accessLevel": "authorized"
          },
          "requestEnroll": {
              "accessLevel": "authorized"
          },
          "approveEnroll": {
              "accessLevel": "authorized"
          },
          "enrollApi": {
              "accessLevel": "authorized"
          },
          "revoke": {
              "accessLevel": "authorized"
          },
          "requestRevoke": {
              "accessLevel": "authorized"
          },
          "approveRevoke": {
              "accessLevel": "authorized"
          },
          "search": {
              "accessLevel": "authorized"
          },
          "migrate": {
              "accessLevel": "authorized"
          },
          "requestMigrate": {
              "accessLevel": "authorized"
          },
          "approveMigrate": {
              "accessLevel": "authorized"
          },
          "update": {
              "accessLevel": "authorized"
          },
          "requestUpdate": {
              "accessLevel": "authorized"
          },
          "approveUpdate": {
              "accessLevel": "authorized"
          },
          "recover": {
              "accessLevel": "authorized"
          },
          "requestRecover": {
              "accessLevel": "authorized"
          },
          "approveRecover": {
              "accessLevel": "authorized"
          },
          "recoverApi": {
              "accessLevel": "authorized"
          }
      },
      "cryptoPolicy": {
          "defaultKeyType": "rsa-2048",
          "authorizedKeyTypes": [
              "rsa-2048",
              "rsa-4096"
          ],
          "centralized": true,
          "decentralized": false,
          "escrow": false,
          "p12passwordPolicy": null,
          "p12storeEncryptionType": "DES_AVERAGE",
          "p12passwordMode": "random",
          "showP12PasswordOnEnroll": true,
          "showP12OnEnroll": true,
          "showP12PasswordOnRecover": false,
          "showP12OnRecover": false
      },
      "selfPermissions": {
          "selfRevoke": false,
          "selfUpdate": false,
          "selfRecover": false,
          "selfRenew": false,
          "selfPopRenew": false
      },
      "requestsPolicy": {},
      "displayName": [],
      "description": [],
      "certificateTemplate": {
          "ownerPolicy": {
              "mandatory": false,
              "editableByRequester": false,
              "editableByApprover": false
          },
          "teamPolicy": {
              "mandatory": false,
              "editableByRequester": false,
              "editableByApprover": false
          },
          "contactEmailPolicy": {
              "mandatory": false,
              "editableByRequester": true,
              "editableByApprover": false
          },
          "subject": [
              {
                  "type": "CN",
                  "mandatory": true,
                  "editableByRequester": true,
                  "editableByApprover": false,
                  "index": 2,
                  "value": null,
                  "regex": null,
                  "testing": null,
                  "computationRule": null
              }
          ],
          "sans": [
              {
                  "type": "DNSNAME",
                  "editableByRequester": true,
                  "editableByApprover": false,
                  "max": 2,
                  "min": null,
                  "regex": null,
                  "testing": null,
                  "computationRule": null,
                  "index": 2
              }
          ]
      },
      "csrDataMapping": {},
      "triggers": {
          "onEnroll": [],
          "onRenew": [],
          "onRevoke": [],
          "onExpire": null,
          "onPendingEnroll": null,
          "onPendingRevoke": null,
          "onPendingRecover": null,
          "onPendingUpdate": null,
          "onPendingMigrate": null
      }
  }
}

assert {
  res.body: isJson
  res.status: eq 201
  res.body.name: isDefined
  res.body._id: isDefined
}